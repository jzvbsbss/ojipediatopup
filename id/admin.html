<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-messaging-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    :root {
      --primary: #4f46e5;
      --primary-light: #6366f1;
      --primary-dark: #4338ca;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f1f5f9;
      color: #334155;
    }
    
    .status-pending {
      background-color: #fffbeb;
      color: #b45309;
      border: 1px solid #fcd34d;
    }
    .status-completed {
      background-color: #ecfdf5;
      color: #047857;
      border: 1px solid #6ee7b7;
    }
    .status-cancelled {
      background-color: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fca5a5;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-shadow {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .highlight-row {
      transition: all 0.2s ease;
      background-color: white;
    }
    
    .highlight-row:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      background-color: #ffffff;
    }
    
    .ml-gradient-text {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .ml-gradient-bg {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    }
    
    .ml-gradient-bg:hover {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
    }
    
    .notification {
      animation: slideIn 0.3s ease-out, fadeOut 0.5s ease-out 2.5s forwards;
      z-index: 100;
    }
    
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    .table-header {
      background: linear-gradient(to right, #f8fafc, #f1f5f9, #f8fafc);
    }
    
    .whatsapp-link {
      color: #25D366;
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s;
    }
    
    .whatsapp-link:hover {
      text-decoration: underline;
      color: #128C7E;
    }
    
    /* New modern scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c7d2fe;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a5b4fc;
    }
    
    /* Pulse animation for loading */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* Badge styles */
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      line-height: 1;
    }
    
    /* Modal overlay */
    .modal-overlay {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    /* Input focus style */
    .input-focus:focus {
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.3);
    }
    
    /* Button transition */
    .btn-transition {
      transition: all 0.2s ease-in-out;
    }
    
    /* Admin Login Page Styles */
    .admin-login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f1f5f9;
    }
    
    .admin-login-card {
      background-color: white;
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      padding: 2.5rem;
      width: 100%;
      max-width: 28rem;
      text-align: center;
    }
    
    .admin-login-icon {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      width: 5rem;
      height: 5rem;
      margin: 0 auto 1.5rem;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
    }
    
    /* Notification permission button */
    .notification-permission-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      display: flex;
      align-items: center;
      font-weight: 500;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .notification-permission-btn:hover {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
    }
    
    .notification-permission-btn i {
      margin-right: 8px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .table-header {
        display: none;
      }
      
      .highlight-row {
        grid-template-columns: 1fr !important;
        gap: 0.75rem;
        padding: 1.25rem;
      }
      
      .highlight-row > div {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .highlight-row > div::before {
        content: attr(data-label);
        font-weight: 600;
        margin-right: 1rem;
        color: #64748b;
      }
      
      .stats-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem;
      }
      
      .modal-content {
        width: 95% !important;
        margin: 1rem auto !important;
      }
      
      .admin-login-card {
        padding: 1.5rem;
        margin: 1rem;
      }
      
      .notification-permission-btn {
        bottom: 70px;
        right: 10px;
        padding: 10px 16px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Admin Login Screen -->
  <div id="adminLoginScreen" class="admin-login-container">
    <div class="admin-login-card">
      <div class="admin-login-icon">
        <i class="fas fa-lock"></i>
      </div>
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Akses Admin</h2>
      <p class="text-gray-600 mb-6">Masukkan kode admin untuk melanjutkan</p>
      
      <div class="mb-4">
        <input type="password" id="adminCodeInput" placeholder="Masukkan kode admin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-150">
      </div>
      
      <button id="submitAdminCode" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition duration-150 flex items-center justify-center">
        <i class="fas fa-sign-in-alt mr-2"></i> Masuk
      </button>
      
      <div id="adminCodeError" class="mt-3 text-sm text-red-600 hidden">
        <i class="fas fa-exclamation-circle mr-1"></i> Kode admin salah, coba lagi.
      </div>
    </div>
  </div>

  <!-- Dashboard Content (Hidden by default) -->
  <div id="dashboardContent" class="min-h-screen flex flex-col hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div class="flex items-center">
            <div class="ml-gradient-bg p-3 rounded-xl mr-3 shadow-md">
              <i class="fas fa-gamepad text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-2xl font-bold text-gray-900">
                <span class="ml-gradient-text">Admin Dashboard</span>
              </h1>
            </div>
          </div>
          <div class="flex flex-col sm:flex-row items-stretch sm:items-center w-full md:w-auto gap-3">
            <div class="relative flex-grow">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                <i class="fas fa-search"></i>
              </div>
              <input type="text" placeholder="Cari pesanan..." class="input-focus block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-lg leading-5 bg-white placeholder-gray-400 focus:outline-none focus:border-indigo-500 sm:text-sm transition duration-150">
            </div>
            <button id="refreshBtn" class="ml-gradient-bg inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white hover:shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 btn-transition">
              <i class="fas fa-sync-alt mr-2"></i> Segarkan
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 stats-grid">
        <div class="bg-white overflow-hidden shadow rounded-xl border border-gray-200 hover:shadow-md transition duration-200 card-shadow">
          <div class="px-5 py-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-3 shadow-inner">
                <i class="fas fa-shopping-cart text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dt class="text-sm font-medium text-gray-500 truncate">Total Pesanan</dt>
                <dd class="flex items-baseline">
                  <div class="text-2xl font-semibold text-gray-900" id="totalOrders">0</div>
                  <div class="ml-2 flex items-baseline text-sm font-semibold text-green-600 hidden" id="totalChange">
                    <i class="fas fa-arrow-up mr-1"></i>
                    <span>0%</span>
                  </div>
                </dd>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-white overflow-hidden shadow rounded-xl border border-gray-200 hover:shadow-md transition duration-200 card-shadow">
          <div class="px-5 py-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-3 shadow-inner">
                <i class="fas fa-check-circle text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dt class="text-sm font-medium text-gray-500 truncate">Selesai</dt>
                <dd class="flex items-baseline">
                  <div class="text-2xl font-semibold text-gray-900" id="completedOrders">0</div>
                  <div class="ml-2 flex items-baseline text-sm font-semibold text-green-600 hidden" id="completedChange">
                    <i class="fas fa-arrow-up mr-1"></i>
                    <span>0%</span>
                  </div>
                </dd>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-white overflow-hidden shadow rounded-xl border border-gray-200 hover:shadow-md transition duration-200 card-shadow">
          <div class="px-5 py-6">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-gradient-to-br from-amber-500 to-amber-600 rounded-xl p-3 shadow-inner">
                <i class="fas fa-clock text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dt class="text-sm font-medium text-gray-500 truncate">Pending</dt>
                <dd class="flex items-baseline">
                  <div class="text-2xl font-semibold text-gray-900" id="pendingOrders">0</div>
                  <div class="ml-2 flex items-baseline text-sm font-semibold text-red-600 hidden" id="pendingChange">
                    <i class="fas fa-arrow-down mr-1"></i>
                    <span>0%</span>
                  </div>
                </dd>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="bg-white shadow-lg overflow-hidden rounded-xl border border-gray-200 card-shadow">
        <div class="px-6 py-5 border-b border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <h3 class="text-lg leading-6 font-bold text-gray-900">Pesanan Terbaru</h3>
            <p class="mt-1 text-sm text-gray-500">Daftar semua pesanan pembelian diamond dari pelanggan</p>
          </div>
          <div class="flex space-x-3 w-full sm:w-auto">
            <div class="relative">
              <select class="appearance-none input-focus block w-full pl-3 pr-8 py-2 border border-gray-200 rounded-lg leading-5 bg-white text-gray-700 focus:outline-none focus:border-indigo-500 sm:text-sm transition duration-150">
                <option>Semua Status</option>
                <option>Pending</option>
                <option>Selesai</option>
                <option>Dibatalkan</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none text-gray-400">
                <i class="fas fa-chevron-down text-xs"></i>
              </div>
            </div>
            <button class="inline-flex items-center px-3.5 py-2 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 btn-transition">
              <i class="fas fa-download mr-2"></i> Ekspor
            </button>
          </div>
        </div>
        
        
        <!-- Orders Container -->
        <div id="ordersContainer" class="divide-y divide-gray-200">
          <!-- Loading state -->
          <div class="py-12 px-6">
            <div class="space-y-4">
              <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
              <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
              <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
              <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
            </div>
          </div>
        </div>
        
        <!-- Empty state (hidden by default) -->
        <div id="emptyState" class="hidden py-16 text-center">
          <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
            <i class="fas fa-box-open text-3xl text-gray-400"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-1">Tidak ada pesanan</h3>
          <p class="text-sm text-gray-500 max-w-md mx-auto">Ketika ada pesanan baru, mereka akan muncul di sini. Pastikan koneksi internet Anda stabil.</p>
        </div>
        
        <!-- Pagination (hidden by default) -->
        <div id="pagination" class="hidden px-6 py-4 border-t border-gray-200 flex items-center justify-between bg-white">
          <div class="flex-1 flex justify-between sm:hidden">
            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
              Sebelumnya
            </a>
            <a href="#" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
              Selanjutnya
            </a>
          </div>
          <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
              <p class="text-sm text-gray-700">
                Menampilkan
                <span class="font-medium">1</span>
                sampai
                <span class="font-medium">10</span>
                dari
                <span class="font-medium">20</span>
                hasil
              </p>
            </div>
            <div>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                  <span class="sr-only">Sebelumnya</span>
                  <i class="fas fa-chevron-left"></i>
                </a>
                <a href="#" aria-current="page" class="z-10 bg-indigo-50 border-indigo-500 text-indigo-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                  1
                </a>
                <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                  2
                </a>
                <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                  3
                </a>
                <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                  <span class="sr-only">Selanjutnya</span>
                  <i class="fas fa-chevron-right"></i>
                </a>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Order Detail Modal -->
  <div id="orderDetailModal" class="fixed z-50 inset-0 overflow-y-auto hidden">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 transition-opacity modal-overlay" aria-hidden="true">
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
      </div>
      
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
      
      <div class="inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl w-full fade-in border border-gray-300">
        <div class="bg-white px-6 pt-6 pb-4 sm:p-6 sm:pb-4">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
              <div class="flex justify-between items-center mb-4">
                <div class="flex items-center">
                  <div class="ml-gradient-bg p-3 rounded-xl mr-3 shadow-md">
                    <i class="fas fa-receipt text-white"></i>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-gray-900" id="modal-title">
                      Detail Pesanan
                    </h3>
                    <p class="text-sm text-gray-500 mt-1">Informasi lengkap tentang pesanan</p>
                  </div>
                </div>
                <button id="closeDetailModal" type="button" class="text-gray-400 hover:text-gray-500 focus:outline-none btn-transition">
                  <i class="fas fa-times text-xl"></i>
                </button>
              </div>
              
              <div class="mt-4">
                <div id="orderDetailContent" class="space-y-6">
                  <!-- Order details will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-gray-50 px-6 py-4 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-200">
          <button id="completeOrderBtn" type="button" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm hidden transition duration-150 btn-transition">
            <i class="fas fa-check-circle mr-2"></i> Selesaikan Pesanan
          </button>
          <button id="cancelOrderBtn" type="button" class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm hidden transition duration-150 btn-transition">
            <i class="fas fa-times-circle mr-2"></i> Batalkan Pesanan
          </button>
          <button id="closeModalBtn" type="button" class="mt-3 w-full inline-flex justify-center rounded-lg border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm transition duration-150 btn-transition">
            Tutup
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Permission Button -->
  <button id="notificationPermissionBtn" class="notification-permission-btn hidden">
    <i class="fas fa-bell"></i> Aktifkan Notifikasi
  </button>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAJL3TYPb-lYcaVezaK0HAvd1KO40sy_2s",
      authDomain: "order-oji-pedia.firebaseapp.com",
      databaseURL: "https://order-oji-pedia-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "order-oji-pedia",
      storageBucket: "order-oji-pedia.firebasestorage.app",
      messagingSenderId: "390634204981",
      appId: "1:390634204981:web:c8ced7fecf3f547dc8267c"
    };

    // Initialize Firebase
    const firebaseApp = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const messaging = firebase.messaging();

    // Admin code configuration
    const ADMIN_CODE = "ojixyz$#"; // Change this to your desired admin code

    // Check if admin is already authenticated
    const isAuthenticated = localStorage.getItem('adminAuthenticated') === 'true';

    if (isAuthenticated) {
      showDashboard();
    } else {
      document.getElementById('adminLoginScreen').classList.remove('hidden');
      document.getElementById('dashboardContent').classList.add('hidden');
    }

    // Admin code verification
    document.getElementById('submitAdminCode').addEventListener('click', function() {
      const inputCode = document.getElementById('adminCodeInput').value.trim();
      const errorElement = document.getElementById('adminCodeError');
      
      if (inputCode === ADMIN_CODE) {
        // Correct code
        localStorage.setItem('adminAuthenticated', 'true');
        showDashboard();
      } else {
        // Wrong code
        errorElement.classList.remove('hidden');
        document.getElementById('adminCodeInput').classList.add('border-red-500');
        document.getElementById('adminCodeInput').focus();
        
        // Hide error after 3 seconds
        setTimeout(() => {
          errorElement.classList.add('hidden');
          document.getElementById('adminCodeInput').classList.remove('border-red-500');
        }, 3000);
      }
    });

    // Also allow Enter key to submit
    document.getElementById('adminCodeInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        document.getElementById('submitAdminCode').click();
      }
    });

    // Show dashboard function
    function showDashboard() {
      document.getElementById('adminLoginScreen').classList.add('hidden');
      document.getElementById('dashboardContent').classList.remove('hidden');
      loadOrders();
      initializePushNotifications();
    }

    // Initialize push notifications
    function initializePushNotifications() {
      // Check if notifications are supported
      if (!('Notification' in window)) {
        console.log('This browser does not support notifications');
        return;
      }

      // Check current permission
      if (Notification.permission === 'granted') {
        // Permission already granted, request FCM token
        requestFCMToken();
      } else if (Notification.permission !== 'denied') {
        // Show button to request permission
        const btn = document.getElementById('notificationPermissionBtn');
        btn.classList.remove('hidden');
        
        btn.addEventListener('click', function() {
          requestNotificationPermission();
        });
      }
    }

    // Request notification permission
    function requestNotificationPermission() {
      Notification.requestPermission().then(permission => {
        const btn = document.getElementById('notificationPermissionBtn');
        
        if (permission === 'granted') {
          console.log('Notification permission granted.');
          btn.classList.add('hidden');
          requestFCMToken();
          
          // Show success message
          const notification = document.createElement('div');
          notification.className = 'notification fixed bottom-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
          notification.innerHTML = `
            <i class="fas fa-check-circle mr-2"></i>
            Notifikasi diaktifkan! Anda akan menerima pemberitahuan pesanan baru.
          `;
          document.body.appendChild(notification);
          
          setTimeout(() => notification.remove(), 3000);
        } else {
          console.log('Unable to get permission to notify.');
          btn.textContent = 'Izin Ditolak. Klik untuk Coba Lagi';
        }
      });
    }

    // Request FCM token
    function requestFCMToken() {
      // Get registration token. Initially this makes a network call, once retrieved
      // subsequent calls to getToken will return from cache.
      messaging.getToken({ vapidKey: 'BLHjQvJQJ6v9QZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQZJQ' }).then((currentToken) => {
        if (currentToken) {
          // Send the token to your server and update the UI if necessary
          console.log('FCM Token:', currentToken);
          saveTokenToDatabase(currentToken);
        } else {
          // Show permission request UI
          console.log('No registration token available. Request permission to generate one.');
          const btn = document.getElementById('notificationPermissionBtn');
          btn.classList.remove('hidden');
        }
      }).catch((err) => {
        console.log('An error occurred while retrieving token. ', err);
      });
    }

    // Save token to database
    function saveTokenToDatabase(token) {
      // Here you would typically send the token to your server
      // For this example, we'll just store it in localStorage
      localStorage.setItem('fcmToken', token);
    }

    // Setup foreground message handler
    messaging.onMessage((payload) => {
      console.log('Message received. ', payload);
      
      // Show a notification
      const notificationTitle = payload.notification.title || 'Pesanan Baru';
      const notificationOptions = {
        body: payload.notification.body || 'Ada pesanan baru yang membutuhkan tindakan Anda',
        icon: '/favicon.ico',
        badge: '/favicon.ico'
      };
      
      // Show notification
      if (Notification.permission === 'granted') {
        new Notification(notificationTitle, notificationOptions);
      }
      
      // Also show in-app notification
      const inAppNotification = document.createElement('div');
      inAppNotification.className = 'notification fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
      inAppNotification.innerHTML = `
        <i class="fas fa-shopping-cart mr-2"></i>
        ${payload.notification.body || 'Pesanan baru diterima!'}
      `;
      document.body.appendChild(inAppNotification);
      
      setTimeout(() => inAppNotification.remove(), 5000);
      
      // Play notification sound
      playNotificationSound();
      
      // Refresh orders to show the new one
      loadOrders();
    });

    // Play notification sound
    function playNotificationSound() {
      const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
      audio.play().catch(e => console.log('Error playing sound:', e));
    }

    // Format number with thousand separator
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Format date
    function formatDate(timestamp) {
      if (!timestamp) return 'Tidak tersedia';
      
      const date = new Date(timestamp);
      if (isNaN(date.getTime())) return 'Tidak tersedia';
      
      const options = { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return date.toLocaleDateString('id-ID', options);
    }

    // Format WhatsApp number to create a clickable link
    function formatWhatsAppNumber(whatsapp) {
      if (!whatsapp) return '-';
      
      // Remove any non-digit characters
      const cleanedNumber = whatsapp.replace(/\D/g, '');
      
      // Check if the number starts with '0' (Indonesia format)
      let formattedNumber = cleanedNumber;
      if (cleanedNumber.startsWith('0')) {
        formattedNumber = '62' + cleanedNumber.substring(1);
      } else if (!cleanedNumber.startsWith('62') && !cleanedNumber.startsWith('+')) {
        formattedNumber = '62' + cleanedNumber;
      }
      
      // Create WhatsApp link
      return `<a href="https://wa.me/${formattedNumber}" target="_blank" class="whatsapp-link">
                <i class="fab fa-whatsapp mr-1"></i>${whatsapp}
              </a>`;
    }

    // Update stats counters
    function updateStats(orders) {
      if (!orders) {
        document.getElementById('totalOrders').textContent = '0';
        document.getElementById('completedOrders').textContent = '0';
        document.getElementById('pendingOrders').textContent = '0';
        return;
      }
      
      const total = Object.keys(orders).length;
      let completed = 0;
      let pending = 0;
      
      Object.values(orders).forEach(order => {
        if (order.status === 'completed') completed++;
        if (order.status === 'pending') pending++;
      });
      
      document.getElementById('totalOrders').textContent = total;
      document.getElementById('completedOrders').textContent = completed;
      document.getElementById('pendingOrders').textContent = pending;
    }

    // Load orders from Firebase
    function loadOrders() {
      const ordersRef = database.ref('orders');
      const ordersContainer = document.getElementById('ordersContainer');
      const emptyState = document.getElementById('emptyState');
      
      ordersContainer.innerHTML = `
        <div class="py-12 px-6">
          <div class="space-y-4">
            <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
            <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
            <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
            <div class="h-16 bg-gray-100 rounded-lg animate-pulse"></div>
          </div>
        </div>
      `;
      
      emptyState.classList.add('hidden');
      
      ordersRef.on('value', (snapshot) => {
        const orders = snapshot.val();
        updateStats(orders);
        
        if (!orders) {
          ordersContainer.innerHTML = '';
          emptyState.classList.remove('hidden');
          return;
        }
        
        ordersContainer.innerHTML = '';
        
        // Convert to array and sort by timestamp (newest first)
        const ordersArray = Object.entries(orders).map(([id, order]) => ({ id, ...order }));
        ordersArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
        
        ordersArray.forEach((order) => {
          const statusClass = order.status === 'completed' ? 'status-completed' : 
                            order.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
          
          const statusText = order.status === 'completed' ? 'Selesai' : 
                           order.status === 'cancelled' ? 'Dibatalkan' : 'Pending';
          
          const orderElement = document.createElement('div');
          orderElement.className = 'grid grid-cols-12 gap-4 px-6 py-4 items-center highlight-row';
          
          // Truncate long IDs for better display
          const shortOrderId = order.id.length > 8 ? order.id.substring(0, 6) + '...' : order.id;
          const shortUserId = order.userId.length > 12 ? order.userId.substring(0, 10) + '...' : order.userId;
          
          orderElement.innerHTML = `
            <div class="col-span-2" data-label="Pesanan">
              <div class="flex items-center">
                <div class="bg-indigo-100 p-2 rounded-lg mr-3">
                  <i class="fas fa-shopping-bag text-indigo-600"></i>
                </div>
                <div>
                  <div class="text-sm font-medium text-gray-900">${shortOrderId}</div>
                  <div class="text-xs text-gray-500">${formatDate(order.timestamp).split(',')[0]}</div>
                </div>
              </div>
            </div>
            <div class="col-span-2" data-label="Pelanggan">
              <div class="text-sm font-medium text-gray-900">${order.nickname || 'Tidak ada nickname'}</div>
              <div class="text-xs text-gray-500">${shortUserId}</div>
            </div>
            <div class="col-span-1 text-sm text-gray-500" data-label="Server">${order.serverId}</div>
            <div class="col-span-1 text-sm text-gray-500" data-label="Diamond">${order.diamondAmount}</div>
            <div class="col-span-1 text-sm text-gray-500" data-label="Jumlah">${order.quantity}</div>
            <div class="col-span-1 text-sm font-medium text-blue-600" data-label="Total">Rp${formatNumber(order.total)}</div>
            <div class="col-span-2" data-label="Pembayaran">
              <div class="flex items-center">
                <div class="bg-gray-100 p-1 rounded mr-2">
                  <i class="fas fa-wallet text-gray-600 text-xs"></i>
                </div>
                <div>
                  <div class="text-sm text-gray-500">${order.paymentMethod}</div>
                  <div class="text-xs text-gray-400">${order.paymentMethod.includes('Transfer') ? 'Manual' : 'Otomatis'}</div>
                </div>
              </div>
            </div>
            <div class="col-span-1" data-label="Status">
              <span class="px-3 py-1 text-xs font-medium rounded-full ${statusClass}">${statusText}</span>
            </div>
            <div class="col-span-1 flex justify-end" data-label="Aksi">
              <div class="flex space-x-2">
                <button class="view-order-btn inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 btn-transition" data-orderid="${order.id}" title="Lihat Detail">
                  <i class="fas fa-eye text-xs"></i>
                </button>
                <button class="delete-order-btn inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 btn-transition" data-orderid="${order.id}" title="Hapus Pesanan">
                  <i class="fas fa-trash text-xs"></i>
                </button>
              </div>
            </div>
          `;
          
          ordersContainer.appendChild(orderElement);
        });
        
        // Add event listeners to view buttons
        document.querySelectorAll('.view-order-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const orderId = this.getAttribute('data-orderid');
            showOrderDetails(orderId);
          });
        });
        
        // Add event listeners to delete buttons
        document.querySelectorAll('.delete-order-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const orderId = this.getAttribute('data-orderid');
            showDeleteConfirmation(orderId);
          });
        });
      });
    }

    // Show delete confirmation dialog
    function showDeleteConfirmation(orderId) {
      const modal = document.createElement('div');
      modal.className = 'fixed z-50 inset-0 overflow-y-auto';
      modal.innerHTML = `
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
          <div class="fixed inset-0 transition-opacity modal-overlay" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
          </div>
          
          <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
          
          <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full fade-in">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
              <div class="sm:flex sm:items-start">
                <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                  <i class="fas fa-exclamation-triangle text-red-600"></i>
                </div>
                <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                  <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Hapus Pesanan</h3>
                  <div class="mt-2">
                    <p class="text-sm text-gray-500">Apakah Anda yakin ingin menghapus pesanan ini? Tindakan ini tidak dapat dibatalkan.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
              <button type="button" id="confirmDeleteBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Hapus
              </button>
              <button type="button" id="cancelDeleteBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Batal
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        deleteOrder(orderId);
        modal.remove();
      });
      
      document.getElementById('cancelDeleteBtn').addEventListener('click', function() {
        modal.remove();
      });
    }

    // Show order details
    function showOrderDetails(orderId) {
      const orderRef = database.ref(`orders/${orderId}`);
      const modal = document.getElementById('orderDetailModal');
      const content = document.getElementById('orderDetailContent');
      const completeBtn = document.getElementById('completeOrderBtn');
      const cancelBtn = document.getElementById('cancelOrderBtn');
      
      content.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-circle-notch fa-spin text-2xl text-indigo-500"></i>
          <p class="mt-2 text-sm text-gray-500">Memuat detail pesanan...</p>
        </div>
      `;
      modal.classList.remove('hidden');
      
      orderRef.once('value').then((snapshot) => {
        const order = snapshot.val();
        
        if (!order) {
          content.innerHTML = `
            <div class="text-center py-8">
              <i class="fas fa-exclamation-triangle text-2xl text-red-500"></i>
              <p class="mt-2 text-sm text-red-500">Pesanan tidak ditemukan</p>
            </div>
          `;
          return;
        }
        
        const statusClass = order.status === 'completed' ? 'status-completed' : 
                          order.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
        
        const statusText = order.status === 'completed' ? 'Selesai' : 
                         order.status === 'cancelled' ? 'Dibatalkan' : 'Pending';
        
        content.innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Order Information -->
            <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Informasi Pesanan</h4>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">ID Pesanan:</span>
                  <span class="text-sm text-gray-900 font-medium">${orderId}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Status:</span>
                  <span class="text-sm"><span class="px-3 py-1 rounded-full ${statusClass}">${statusText}</span></span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Tanggal:</span>
                  <span class="text-sm text-gray-900 font-medium">${formatDate(order.timestamp)}</span>
                </div>
              </div>
            </div>
            
            <!-- Game Information -->
            <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Informasi Game</h4>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Game:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.game || 'Mobile Legends'}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Diamond:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.diamondAmount} (Rp${formatNumber(order.diamondPrice)} per item)</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Kuantitas:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.quantity}</span>
                </div>
              </div>
            </div>
            
            <!-- Account Information -->
            <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Informasi Akun</h4>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">User ID:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.userId}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Server ID:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.serverId}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Nickname:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.nickname || '-'}</span>
                </div>
              </div>
            </div>
            
            <!-- Customer Information -->
            <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Informasi Pelanggan</h4>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Email:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.email}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">WhatsApp:</span>
                  <span class="text-sm text-gray-900 font-medium">${formatWhatsAppNumber(order.whatsapp)}</span>
                </div>
              </div>
            </div>
            
            <!-- Payment Information -->
            <div class="md:col-span-2 bg-gray-50 p-5 rounded-xl border border-gray-200">
              <h4 class="text-lg font-bold text-gray-900 mb-4 pb-2 border-b border-gray-200">Informasi Pembayaran</h4>
              <div class="space-y-4">
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Metode Pembayaran:</span>
                  <span class="text-sm text-gray-900 font-medium">${order.paymentMethod}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Subtotal:</span>
                  <span class="text-sm text-gray-900 font-medium">Rp${formatNumber(order.subtotal)}</span>
                </div>
                ${order.discount > 0 ? `
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Diskon:</span>
                  <span class="text-sm text-red-500 font-medium">-Rp${formatNumber(order.discount)} (${order.promoCode || 'Promo'})</span>
                </div>
                ` : ''}
                <div class="flex justify-between">
                  <span class="text-sm font-medium text-gray-500">Biaya Admin:</span>
                  <span class="text-sm text-gray-900 font-medium">Rp${formatNumber(order.adminFee)}</span>
                </div>
                <div class="flex justify-between border-t pt-3 mt-3">
                  <span class="text-sm font-bold text-gray-700">Total Pembayaran:</span>
                  <span class="text-sm font-bold text-blue-600">Rp${formatNumber(order.total)}</span>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Show/hide action buttons based on order status
        completeBtn.classList.add('hidden');
        cancelBtn.classList.add('hidden');
        
        if (order.status === 'pending') {
          completeBtn.classList.remove('hidden');
          cancelBtn.classList.remove('hidden');
          
          completeBtn.onclick = function() {
            showCompleteConfirmation(orderId);
          };
          
          cancelBtn.onclick = function() {
            showCancelConfirmation(orderId);
          };
        }
      });
    }

    // Show complete confirmation dialog
    function showCompleteConfirmation(orderId) {
      const modal = document.createElement('div');
      modal.className = 'fixed z-50 inset-0 overflow-y-auto';
      modal.innerHTML = `
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
          <div class="fixed inset-0 transition-opacity modal-overlay" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
          </div>
          
          <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
          
          <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full fade-in">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
              <div class="sm:flex sm:items-start">
                <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 sm:mx-0 sm:h-10 sm:w-10">
                  <i class="fas fa-check-circle text-green-600"></i>
                </div>
                <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                  <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Selesaikan Pesanan</h3>
                  <div class="mt-2">
                    <p class="text-sm text-gray-500">Apakah Anda yakin ingin menandai pesanan ini sebagai selesai? Pastikan diamond sudah dikirim ke pelanggan.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
              <button type="button" id="confirmCompleteBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Ya, Selesaikan
              </button>
              <button type="button" id="cancelCompleteBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Batal
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirmCompleteBtn').addEventListener('click', function() {
        updateOrderStatus(orderId, 'completed');
        modal.remove();
        document.getElementById('orderDetailModal').classList.add('hidden');
      });
      
      document.getElementById('cancelCompleteBtn').addEventListener('click', function() {
        modal.remove();
      });
    }

    // Show cancel confirmation dialog
    function showCancelConfirmation(orderId) {
      const modal = document.createElement('div');
      modal.className = 'fixed z-50 inset-0 overflow-y-auto';
      modal.innerHTML = `
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
          <div class="fixed inset-0 transition-opacity modal-overlay" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
          </div>
          
          <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
          
          <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full fade-in">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
              <div class="sm:flex sm:items-start">
                <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                  <i class="fas fa-exclamation-triangle text-red-600"></i>
                </div>
                <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                  <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">Batalkan Pesanan</h3>
                  <div class="mt-2">
                    <p class="text-sm text-gray-500">Apakah Anda yakin ingin membatalkan pesanan ini? Pastikan Anda sudah mengembalikan pembayaran jika diperlukan.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
              <button type="button" id="confirmCancelBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Ya, Batalkan
              </button>
              <button type="button" id="cancelCancelBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm btn-transition">
                Batal
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirmCancelBtn').addEventListener('click', function() {
        updateOrderStatus(orderId, 'cancelled');
        modal.remove();
        document.getElementById('orderDetailModal').classList.add('hidden');
      });
      
      document.getElementById('cancelCancelBtn').addEventListener('click', function() {
        modal.remove();
      });
    }

    // Update order status
    function updateOrderStatus(orderId, status) {
      const orderRef = database.ref(`orders/${orderId}`);
      
      const statusText = status === 'completed' ? 'selesai' : 'dibatalkan';
      const icon = status === 'completed' ? 'fa-check-circle' : 'fa-times-circle';
      const bgColor = status === 'completed' ? 'bg-green-500' : 'bg-red-500';
      
      orderRef.update({ 
        status: status,
        updatedAt: new Date().getTime()
      })
        .then(() => {
          // Show success notification
          const notification = document.createElement('div');
          notification.className = `notification fixed bottom-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-center`;
          notification.innerHTML = `
            <i class="fas ${icon} mr-2"></i>
            Status pesanan berhasil diubah menjadi ${statusText}
          `;
          document.body.appendChild(notification);
          
          // Remove notification after animation
          setTimeout(() => notification.remove(), 3000);
          
          // Reload orders to reflect changes
          loadOrders();
        })
        .catch((error) => {
          console.error('Error updating order:', error);
          
          // Show error notification
          const notification = document.createElement('div');
          notification.className = 'notification fixed bottom-4 right-4 bg-red-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
          notification.innerHTML = `
            <i class="fas fa-exclamation-circle mr-2"></i>
            Gagal memperbarui status pesanan
          `;
          document.body.appendChild(notification);
          
          setTimeout(() => notification.remove(), 3000);
        });
    }

    // Delete order
    function deleteOrder(orderId) {
      const orderRef = database.ref(`orders/${orderId}`);
      
      orderRef.remove()
        .then(() => {
          // Show success notification
          const notification = document.createElement('div');
          notification.className = 'notification fixed bottom-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
          notification.innerHTML = `
            <i class="fas fa-check-circle mr-2"></i>
            Pesanan berhasil dihapus
          `;
          document.body.appendChild(notification);
          
          // Remove notification after animation
          setTimeout(() => notification.remove(), 3000);
          
          // Reload orders to reflect changes
          loadOrders();
        })
        .catch((error) => {
          console.error('Error deleting order:', error);
          
          // Show error notification
          const notification = document.createElement('div');
          notification.className = 'notification fixed bottom-4 right-4 bg-red-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
          notification.innerHTML = `
            <i class="fas fa-exclamation-circle mr-2"></i>
            Gagal menghapus pesanan
          `;
          document.body.appendChild(notification);
          
          setTimeout(() => notification.remove(), 3000);
        });
    }

    // Close modal
    document.getElementById('closeDetailModal').addEventListener('click', function() {
      document.getElementById('orderDetailModal').classList.add('hidden');
    });

    document.getElementById('closeModalBtn').addEventListener('click', function() {
      document.getElementById('orderDetailModal').classList.add('hidden');
    });

    // Refresh button
    document.getElementById('refreshBtn').addEventListener('click', function() {
      const btn = this;
      btn.innerHTML = '<i class="fas fa-sync-alt fa-spin mr-2"></i> Memuat...';
      btn.disabled = true;
      
      loadOrders();
      
      setTimeout(() => {
        btn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Segarkan';
        btn.disabled = false;
        
        // Show refresh notification
        const notification = document.createElement('div');
        notification.className = 'notification fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center';
        notification.innerHTML = `
          <i class="fas fa-check-circle mr-2"></i>
          Data pesanan berhasil diperbarui
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => notification.remove(), 3000);
      }, 1000);
    });

    // Load orders when page loads (if authenticated)
    if (isAuthenticated) {
      window.addEventListener('load', loadOrders);
    }
  </script>
</body>
</html>
